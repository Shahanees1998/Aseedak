"use strict";(()=>{var e={};e.id=7766,e.ids=[7766],e.modules={399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},354:(e,r,o)=>{o.r(r),o.d(r,{originalPathname:()=>f,patchFetch:()=>h,requestAsyncStorage:()=>m,routeModule:()=>c,serverHooks:()=>O,staticGenerationAsyncStorage:()=>p});var t={};o.r(t),o.d(t,{POST:()=>l});var n=o(3277),a=o(5265),i=o(5356),s=o(7076);(function(){var e=Error("Cannot find module 'next-auth'");throw e.code="MODULE_NOT_FOUND",e})(),function(){var e=Error("Cannot find module '@prisma/client'");throw e.code="MODULE_NOT_FOUND",e}(),function(){var e=Error("Cannot find module 'zod'");throw e.code="MODULE_NOT_FOUND",e}();let u=Object(function(){var e=Error("Cannot find module '@prisma/client'");throw e.code="MODULE_NOT_FOUND",e}())(),d=Object(function(){var e=Error("Cannot find module 'zod'");throw e.code="MODULE_NOT_FOUND",e}()).object({name:Object(function(){var e=Error("Cannot find module 'zod'");throw e.code="MODULE_NOT_FOUND",e}()).string().min(1,"Name is required"),description:Object(function(){var e=Error("Cannot find module 'zod'");throw e.code="MODULE_NOT_FOUND",e}()).string().optional(),email:Object(function(){var e=Error("Cannot find module 'zod'");throw e.code="MODULE_NOT_FOUND",e}()).string().email("Valid email is required"),subject:Object(function(){var e=Error("Cannot find module 'zod'");throw e.code="MODULE_NOT_FOUND",e}()).string().optional(),message:Object(function(){var e=Error("Cannot find module 'zod'");throw e.code="MODULE_NOT_FOUND",e}()).string().optional()});async function l(e){try{let r=await Object(function(){var e=Error("Cannot find module 'next-auth'");throw e.code="MODULE_NOT_FOUND",e}())();if(!r||r.user?.role!=="HOTEL_ADMIN")return s.NextResponse.json({error:"Unauthorized"},{status:401});let o=await e.json(),t=d.parse(o),n=r.user.hotelId;if(!n)return s.NextResponse.json({error:"Hotel not found"},{status:400});let a=await u.hotel.findUnique({where:{id:n},select:{slug:!0,name:!0}});if(!a)return s.NextResponse.json({error:"Hotel not found"},{status:404});let i=process.env.APP_URL||"http://localhost:3000",l=`${i}/feedback/${a.slug}`,c=t.subject||`Feedback Request - ${a.name}`,m=t.message||`Dear Guest,

We hope you enjoyed your stay at ${a.name}!

We would love to hear about your experience. Please take a moment to share your feedback with us:

${l}

Your feedback helps us improve our services and helps other travelers discover our wonderful property.

Thank you for choosing ${a.name}!

Best regards,
The ${a.name} Team`,p=`mailto:${t.email}?subject=${encodeURIComponent(c)}&body=${encodeURIComponent(m)}`;return s.NextResponse.json({message:"Email link generated successfully",emailLink:{name:t.name,email:t.email,subject:c,message:m,mailtoLink:p,feedbackUrl:l}})}catch(e){if(console.error("Error generating email link:",e),e instanceof Object(function(){var e=Error("Cannot find module 'zod'");throw e.code="MODULE_NOT_FOUND",e}()).ZodError)return s.NextResponse.json({error:"Validation error",details:e.errors},{status:400});return s.NextResponse.json({error:"Internal server error"},{status:500})}}let c=new n.AppRouteRouteModule({definition:{kind:a.x.APP_ROUTE,page:"/api/email-links/generate/route",pathname:"/api/email-links/generate",filename:"route",bundlePath:"app/api/email-links/generate/route"},resolvedPagePath:"/Users/mac/Documents/primochatadmin/hotel-feedback-saas/app/api/email-links/generate/route.ts",nextConfigOutput:"",userland:t}),{requestAsyncStorage:m,staticGenerationAsyncStorage:p,serverHooks:O}=c,f="/api/email-links/generate/route";function h(){return(0,i.patchFetch)({serverHooks:O,staticGenerationAsyncStorage:p})}}};var r=require("../../../../webpack-runtime.js");r.C(e);var o=e=>r(r.s=e),t=r.X(0,[916,3786],()=>o(354));module.exports=t})();