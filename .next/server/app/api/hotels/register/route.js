"use strict";(()=>{var e={};e.id=7077,e.ids=[7077],e.modules={399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},2175:(e,r,t)=>{t.r(r),t.d(r,{originalPathname:()=>f,patchFetch:()=>p,requestAsyncStorage:()=>m,routeModule:()=>c,serverHooks:()=>O,staticGenerationAsyncStorage:()=>h});var o={};t.r(o),t.d(o,{POST:()=>u});var a=t(3277),n=t(5265),i=t(5356),s=t(7076);(function(){var e=Error("Cannot find module '@prisma/client'");throw e.code="MODULE_NOT_FOUND",e})(),function(){var e=Error("Cannot find module 'bcryptjs'");throw e.code="MODULE_NOT_FOUND",e}(),function(){var e=Error("Cannot find module 'zod'");throw e.code="MODULE_NOT_FOUND",e}();let d=Object(function(){var e=Error("Cannot find module '@prisma/client'");throw e.code="MODULE_NOT_FOUND",e}())(),l=Object(function(){var e=Error("Cannot find module 'zod'");throw e.code="MODULE_NOT_FOUND",e}()).object({firstName:Object(function(){var e=Error("Cannot find module 'zod'");throw e.code="MODULE_NOT_FOUND",e}()).string().min(1,"First name is required"),lastName:Object(function(){var e=Error("Cannot find module 'zod'");throw e.code="MODULE_NOT_FOUND",e}()).string().min(1,"Last name is required"),email:Object(function(){var e=Error("Cannot find module 'zod'");throw e.code="MODULE_NOT_FOUND",e}()).string().email("Invalid email address"),password:Object(function(){var e=Error("Cannot find module 'zod'");throw e.code="MODULE_NOT_FOUND",e}()).string().min(6,"Password must be at least 6 characters"),confirmPassword:Object(function(){var e=Error("Cannot find module 'zod'");throw e.code="MODULE_NOT_FOUND",e}()).string(),hotelName:Object(function(){var e=Error("Cannot find module 'zod'");throw e.code="MODULE_NOT_FOUND",e}()).string().min(1,"Hotel name is required"),hotelEmail:Object(function(){var e=Error("Cannot find module 'zod'");throw e.code="MODULE_NOT_FOUND",e}()).string().email("Invalid hotel email address"),hotelPhone:Object(function(){var e=Error("Cannot find module 'zod'");throw e.code="MODULE_NOT_FOUND",e}()).string().optional(),hotelAddress:Object(function(){var e=Error("Cannot find module 'zod'");throw e.code="MODULE_NOT_FOUND",e}()).string().min(1,"Hotel address is required"),hotelCity:Object(function(){var e=Error("Cannot find module 'zod'");throw e.code="MODULE_NOT_FOUND",e}()).string().min(1,"City is required"),hotelState:Object(function(){var e=Error("Cannot find module 'zod'");throw e.code="MODULE_NOT_FOUND",e}()).string().min(1,"State is required"),hotelCountry:Object(function(){var e=Error("Cannot find module 'zod'");throw e.code="MODULE_NOT_FOUND",e}()).string().min(1,"Country is required"),hotelZipCode:Object(function(){var e=Error("Cannot find module 'zod'");throw e.code="MODULE_NOT_FOUND",e}()).string().optional(),subscriptionPlan:Object(function(){var e=Error("Cannot find module 'zod'");throw e.code="MODULE_NOT_FOUND",e}()).enum(["basic","premium","enterprise"])}).refine(e=>e.password===e.confirmPassword,{message:"Passwords don't match",path:["confirmPassword"]});async function u(e){try{let r=await e.json(),o=l.parse(r);if(await d.user.findUnique({where:{email:o.email}}))return s.NextResponse.json({error:"User with this email already exists"},{status:400});if(await d.hotel.findUnique({where:{email:o.hotelEmail}}))return s.NextResponse.json({error:"Hotel with this email already exists"},{status:400});let a=o.hotelName.toLowerCase().replace(/[^a-z0-9]+/g,"-").replace(/(^-|-$)/g,""),n=a,i=1;for(;await d.hotel.findUnique({where:{slug:n}});)n=`${a}-${i}`,i++;let u=await Object(function(){var e=Error("Cannot find module 'bcryptjs'");throw e.code="MODULE_NOT_FOUND",e}())(o.password,12),c=await d.$transaction(async e=>{let r=await e.hotel.create({data:{name:o.hotelName,slug:n,email:o.hotelEmail,phone:o.hotelPhone,address:o.hotelAddress,city:o.hotelCity,state:o.hotelState,country:o.hotelCountry,zipCode:o.hotelZipCode,subscriptionPlan:o.subscriptionPlan,subscriptionStatus:"INACTIVE"}}),t=await e.user.create({data:{firstName:o.firstName,lastName:o.lastName,email:o.email,password:u,role:"HOTEL_ADMIN",hotelId:r.id}});return await e.form.create({data:{hotelId:r.id,name:"Default Feedback Form",description:"Standard guest feedback form",isDefault:!0,isActive:!0,fields:{create:[{label:"Overall Rating",type:"RATING",required:!0,order:1},{label:"How was your stay?",type:"TEXTAREA",required:!0,placeholder:"Tell us about your experience...",order:2},{label:"What did you like most?",type:"TEXT",required:!1,placeholder:"Your favorite aspects...",order:3},{label:"What could we improve?",type:"TEXT",required:!1,placeholder:"Suggestions for improvement...",order:4},{label:"Would you recommend us?",type:"SINGLE_CHOICE",required:!0,options:["Yes","No","Maybe"],order:5}]}}}),{hotel:r,user:t}});try{let{sendEmail:e,emailTemplates:r}=await t.e(7862).then(t.bind(t,7862)),o=r.welcome(c.hotel.name,`${c.user.firstName} ${c.user.lastName}`);await e({to:c.user.email,subject:o.subject,html:o.html})}catch(e){console.error("Failed to send welcome email:",e)}return s.NextResponse.json({message:"Registration successful",hotel:{id:c.hotel.id,name:c.hotel.name,slug:c.hotel.slug},user:{id:c.user.id,email:c.user.email,role:c.user.role}})}catch(e){if(console.error("Registration error:",e),e instanceof Object(function(){var e=Error("Cannot find module 'zod'");throw e.code="MODULE_NOT_FOUND",e}()).ZodError)return s.NextResponse.json({error:"Validation error",details:e.errors},{status:400});return s.NextResponse.json({error:"Internal server error"},{status:500})}}let c=new a.AppRouteRouteModule({definition:{kind:n.x.APP_ROUTE,page:"/api/hotels/register/route",pathname:"/api/hotels/register",filename:"route",bundlePath:"app/api/hotels/register/route"},resolvedPagePath:"/Users/mac/Documents/primochatadmin/hotel-feedback-saas/app/api/hotels/register/route.ts",nextConfigOutput:"",userland:o}),{requestAsyncStorage:m,staticGenerationAsyncStorage:h,serverHooks:O}=c,f="/api/hotels/register/route";function p(){return(0,i.patchFetch)({serverHooks:O,staticGenerationAsyncStorage:h})}}};var r=require("../../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),o=r.X(0,[916,3786],()=>t(2175));module.exports=o})();