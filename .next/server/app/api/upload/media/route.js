"use strict";(()=>{var e={};e.id=8484,e.ids=[8484],e.modules={399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},5315:e=>{e.exports=require("path")},3773:(e,r,i)=>{i.r(r),i.d(r,{originalPathname:()=>v,patchFetch:()=>w,requestAsyncStorage:()=>f,routeModule:()=>m,serverHooks:()=>g,staticGenerationAsyncStorage:()=>c});var t={};i.r(t),i.d(t,{POST:()=>d});var a=i(3277),o=i(5265),s=i(5356),n=i(7076);let l=require("fs/promises");var p=i(5315);!function(){var e=Error("Cannot find module '@prisma/client'");throw e.code="MODULE_NOT_FOUND",e}();let u=Object(function(){var e=Error("Cannot find module '@prisma/client'");throw e.code="MODULE_NOT_FOUND",e}())();async function d(e){try{let r=await e.formData(),i=r.get("file"),t=r.get("reviewId");if(!i)return n.NextResponse.json({error:"No file uploaded"},{status:400});if(!t)return n.NextResponse.json({error:"Review ID is required"},{status:400});if(!["image/jpeg","image/png","image/gif","image/webp","video/mp4","video/webm"].includes(i.type))return n.NextResponse.json({error:"Invalid file type. Only images and videos are allowed."},{status:400});if(i.size>10485760)return n.NextResponse.json({error:"File too large. Maximum size is 10MB."},{status:400});let a=(0,p.join)(process.cwd(),"public","uploads","media");await (0,l.mkdir)(a,{recursive:!0});let o=Date.now(),s=Math.random().toString(36).substring(2,15),d=i.name.split(".").pop(),m=`${o}-${s}.${d}`,f=(0,p.join)(a,m),c=await i.arrayBuffer(),g=Buffer.from(c);await (0,l.writeFile)(f,g);let v=i.type.startsWith("image/")?"image":"video",w=await u.mediaFile.create({data:{reviewId:t,fileName:i.name,fileUrl:`/uploads/media/${m}`,fileType:v,fileSize:i.size,mimeType:i.type}});return n.NextResponse.json({message:"File uploaded successfully",mediaFile:{id:w.id,fileName:w.fileName,fileUrl:w.fileUrl,fileType:w.fileType,fileSize:w.fileSize}})}catch(e){return console.error("Error uploading file:",e),n.NextResponse.json({error:"Internal server error"},{status:500})}}let m=new a.AppRouteRouteModule({definition:{kind:o.x.APP_ROUTE,page:"/api/upload/media/route",pathname:"/api/upload/media",filename:"route",bundlePath:"app/api/upload/media/route"},resolvedPagePath:"/Users/mac/Documents/primochatadmin/hotel-feedback-saas/app/api/upload/media/route.ts",nextConfigOutput:"",userland:t}),{requestAsyncStorage:f,staticGenerationAsyncStorage:c,serverHooks:g}=m,v="/api/upload/media/route";function w(){return(0,s.patchFetch)({serverHooks:g,staticGenerationAsyncStorage:c})}}};var r=require("../../../../webpack-runtime.js");r.C(e);var i=e=>r(r.s=e),t=r.X(0,[916,3786],()=>i(3773));module.exports=t})();